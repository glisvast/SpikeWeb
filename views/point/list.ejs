<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      body{
        overflow:visible;
      }
      .parent {
        position: relative;
        top: 0;
        left: 0;
      }
      .imglistspacebackground {
        position: absolute;
        top: 0;
        right: -100px;
      }
      .imglogo {
        position: absolute;
        top: 30px;
        left: 30px;
      }
      .imgaccount {
        position: absolute;
        top: 30px;
        right: 30px;
      }
      .name {
        position: absolute;
        top: 135px;
        right: 145px;
        font-size: 16pt;
        color: white;
      }
      .imgaddpoint {
        position: absolute;
        top: 340px;
        left: 40px;
      }
      .imgdeletepoint {
        position: absolute;
        top: 340px;
        right: 40px;
      }
      .imgsendpoint {
        position: absolute;
        top: 390px;
        transform: translateX(-50%);
        left: 50%;
      }
      .imgPpoint {
        position: absolute;
        top: 170px;
        right: 30px;
      }
      .imgyourpoint {
        position: absolute;
        top: 140px;
        right: 35px;
      }
      .txtPpoint {
        position: absolute;
        top: 145px;
        right: 100px;
        font-size: 55pt;
        font-weight: bold;
        color:white;
      }
      
      .popup {
        background: #57575799;
        width: 100%;
        height: 100vh;
        position: absolute;
        top: 0;
        display: none;
        justify-content: center;
        align-items: center;
        text-align: center;
      }
      .deletepopup {
        background: #57575799;
        width: 100%;
        height: 100vh;
        position: absolute;
        top: 0;
        display: none;
        justify-content: center;
        align-items: center;
        text-align: center;
      }
      .popup-content {
        height: 433px;
        width: 722px;
        background-image: url("/images/account/account_background.png");
        background-size: 100%;
        padding: 20px;
        border-radius: 5px;
        position: relative;
      }
      .buttongray {
        background-color: #ffffff; /* Green */
        border: none;
        color: black;
        padding: 10px 132px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 0px;
        cursor: pointer;
        border-radius: 6px;
        font-weight: bold;
        font-size: 15pt;
      }
      .close {
        position: absolute;
        text-align: center;
        display: inline-block;
        top: 370px;
        left: 50%;
        transform: translateX(-50%);
      }
      .deleteclose {
        position: absolute;
        text-align: center;
        display: inline-block;
        top: 370px;
        left: 50%;
        transform: translateX(-50%);
      }
      .pointblock {
        margin-top: 10px;
        left: 50%;
        transform: translateX(-50%);
        position: relative;
        height: 92px;
        width: 417px;
        align-content: center;
        display: inline-block;
        background-image: url("/images/list/pointblock_w_s_x.png");
      }
      .parentpointblocks {
        margin-top: 542px;
        padding-bottom: 20px;
        position: absolute;
        /* margin-left: 250px;
        margin-right: 250px; */
        /* display: inline-block; */
        width: 468px;
        overflow-y: auto;
        overflow-x: hidden;
      }
      .pointblockservice {
        position: absolute;
        top: 30%;
        font-size: 15pt;
        right: 13%;
        transform: translateX(-50%);
        transform: translateY(-50%);
      }
      .pointblockpoint {
        position: absolute;
        top: 65%;
        font-size: 25pt;
        right: 13%;
        transform: translateX(-50%);
        transform: translateY(-50%);
      }
      .history{
        margin-top: 440px;
        left:50%;
        transform: translateX(-50%);
        position: absolute;
        width: 417;
      }
      .imgdecoration {
        position: absolute;
        top: 600px;
        left: 0px;
      }
    </style>
  </head>
  <%- include('../header'); %>
  <body style="background-color: #e0e0e0;"" >
    <%#- include("../menu"); %>

    <div class="parent" style="height: 100vh;">
      <img
        class="imglistspacebackground"
        src="/images/list/listspacebackground.png"
        width="600px"
      />
      <a href="/api/point">
        <img class="imglogo" src="/images/main/logo.png" width="100px" />
      </a>
      <div class="imgaccount">
        <a href="/api/user/logout">
          <img
            src="/images/list/logout.png"
            width="66px"
          />
        </a>
      </div>
      
      <a href="#" id="buttonaddpoint">
        <img
          class="imgaddpoint"
          src="/images/list/addpoint.png"
          width="171px"
        />
      </a>

      <a href="#" id="buttondeletepoint">
        <img
          class="imgdeletepoint"
          src="/images/list/deletepoint.png"
          width="169px"
        />
      </a>
      
      <a href="/api/point/send" id="buttonsendpoint">
        <img
          class="imgsendpoint"
          src="/images/list/pointsend.png"
          width="155px"
        />
      </a>

      <a href="/api/point/history" id="buttonhistory">
        <img
          class="history"
          src="/images/list/history.png"
          width="417"
        />
      </a>

      <p class="name"> <%= user.name %></p>
      <img class="imgyourpoint" src="/images/list/userpoint.png" width="101px" />
      <img class="imgPpoint" src="/images/list/Ppoint.png" width="52px" />
      <p class="txtPpoint"> <%= sum %></p>

      <img class="imgdecoration" src="/images/list/listdecoration.png" width="170px" />

      <div class="parentpointblocks">
        <% result.forEach(point => { %>
        <div class="pointblock">
          <div>
            <img
              src="/images/bankicon/<%= point.service %>.png"
              style="position: absolute; width: 60px; top: 50%; left: 17%; transform: translateX(-50%) translateY(-50%);"
            />
            <p class="pointblockservice"> <%= point.service %></p>
            <p class="pointblockpoint"> <%= point.balance %></p>
          </div>
        </div>
        <% }) %>
      </div>

      

      <!-- add Point Popup -->
      <div class="popup">
        <div class="popup-content">
          <div
            style="
              height: 400px;
              width: 300px;
              margin: auto;
              margin-top: 50px;
            "
          >
            <div style="padding-bottom: 20px;">
              <img src="/images/list/addpointtext.png" width="270px" />
            </div>

            <form id="addPointForm" class="text-center" action="#!">
              <!-- Email -->
              <div>
                <input
                  type="text"
                  id="service"
                  required
                  class="form-control-lg form-control mb-4"
                  placeholder="포인트회사"
                />
              </div>

              <!-- Password -->
              <div style="margin-top: 0px;">
                <input
                  type="number"
                  id="balance"
                  required
                  class="form-control-lg form-control mb-4"
                  placeholder="포인트"
                  aria-describedby="materialRegisterFormPasswordHelpBlock"
                />
              </div>

              <div style="margin-top: 0px;">
                <button class="buttongray" type="submit">추가</button>
              </div>

              <div class="close">
                <img src="/images/list/close.png" />
              </div>
              <!-- Sign in button -->
            </form>
          </div>
        </div>
      </div>

      <div class="deletepopup">
        <div class="popup-content">
          <div
            style="
              height: 400px;
              width: 300px;
              margin: auto;
              margin-top: 50px;
            "
          >
            <div style="padding-bottom: 20px;">
              <img src="/images/list/deletepointtext.png" width="270px" />
            </div>

            <form id="deletePointForm" class="text-center" action="#!">
              <!-- Email -->
              <select name="service" id="deleteservice" required style="width: 300px; margin-top: 50px;">
                <% result.forEach(point => { %>
                <option value="<%= point.service %>"><%= point.service %></option>
                <% }) %>
              </select>

              <div style="margin-top: 20px;">
                <button class="buttongray" type="submit">삭제</button>
              </div>

              <div class="deleteclose">
                <img src="/images/list/close.png" />
              </div>
              <!-- Sign in button -->
            </form>
          </div>
        </div>
      </div>
    </div>

    <%- include('../footer'); %>
    <script>
      $(function () {
        console.log("addpoint function called");
        $("#addPointForm").submit((event) => {
          console.log("submit button clicked");

          event.preventDefault();
          // 로그인
          const service = $("#service").val();
          const balance = $("#balance").val();

          console.log(service + "\n" + balance);

          $.ajax({
            url: "/api/point",
            type: "POST",
            data: { service, balance },
          })
            .done(() => {
              alert("추가 완료!");
              location.href = "/api/point/";
            })
            .fail((request, status, error) => {
              console.log(request.responseText);
              alert(request.responseText);
            });
        });
      });
    </script>

    <script>
      $(function () {
        console.log("deletepoint function called");
        $("#deletePointForm").submit((event) => {
          console.log("submit button clicked");
          event.preventDefault();
          // 로그인
          const service = $("#deleteservice").val();
          console.log(service);

          $.ajax({
            url: "/api/point",
            type: "DELETE",
            data: { service },
          })
            .done(() => {
              alert("삭제 완료!");
              location.href = "/api/point/";
            })
            .fail((request, status, error) => {
              console.log(request.responseText);
              alert(request.responseText);
            });
        });
      });
    </script>

    <script>
      document
        .getElementById("buttonaddpoint")
        .addEventListener("click", function () {
          document.querySelector(".popup").style.display = "flex";
          document.querySelector("body").style.overflow = "hidden";
      });

      document.querySelector(".close").addEventListener("click", function () {
        document.querySelector(".popup").style.display = "none";
        document.querySelector("body").style.overflow = "visible";
      });
    </script>

<script>
  document
    .getElementById("buttondeletepoint")
    .addEventListener("click", function () {
      document.querySelector(".deletepopup").style.display = "flex";
      document.querySelector("body").style.overflow = "hidden";
  });

  document.querySelector(".deleteclose").addEventListener("click", function () {
    document.querySelector(".deletepopup").style.display = "none";
    document.querySelector("body").style.overflow = "visible";
  });
</script>
  </body>
</html>
